<%- include('partials/header', { pageTitle: 'Edit Safeguard', active: 'safeguards' }) %>

<div class="container mt-4">
  <h1 class="mb-4">Edit Safeguard</h1>
  <% if (typeof error !== 'undefined' && error) { %>
    <div class="alert alert-danger" role="alert">
      <%= error %>
    </div>
  <% } %>
  <form action="/safeguards/<%= safeguard.id %>" method="POST" class="needs-validation" novalidate>
    <div class="mb-3">
      <label for="name" class="form-label">Name</label>
      <input type="text" class="form-control" id="name" name="name" value="<%= safeguard.name %>" required>
      <div class="invalid-feedback">Name is required.</div>
    </div>
    <div class="mb-3">
      <label for="type" class="form-label">Type</label>
      <input type="text" class="form-control" id="type" name="type" value="<%= safeguard.type %>" required>
      <div class="invalid-feedback">Type is required.</div>
    </div>
    <div class="mb-3">
      <label for="description" class="form-label">Description</label>
      <textarea class="form-control" id="description" name="description" rows="3"><%= safeguard.description %></textarea>
    </div>
    <div class="mb-3">
      <label for="effectiveness" class="form-label">Effectiveness (0-100)</label>
      <input type="number" class="form-control" id="effectiveness" name="effectiveness" min="0" max="100" value="<%= safeguard.effectiveness || 0 %>">
    </div>
    <div class="mb-3">
      <label for="implementation_status" class="form-label">Implementation Status</label>
      <select class="form-select" id="implementation_status" name="implementation_status">
        <option value="Planned" <%= safeguard.implementation_status === 'Planned' ? 'selected' : '' %>>Planned</option>
        <option value="Implemented" <%= safeguard.implementation_status === 'Implemented' ? 'selected' : '' %>>Implemented</option>
        <option value="Verified" <%= safeguard.implementation_status === 'Verified' ? 'selected' : '' %>>Verified</option>
        <option value="N/A" <%= safeguard.implementation_status === 'N/A' ? 'selected' : '' %>>N/A</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="implementation_details" class="form-label">Implementation Details</label>
      <textarea class="form-control" id="implementation_details" name="implementation_details" rows="2"><%= safeguard.implementation_details || '' %></textarea>
    </div>
    <div class="mb-3">
      <label for="created_by" class="form-label">Created By</label>
      <input type="text" class="form-control" id="created_by" name="created_by" value="<%= safeguard.created_by || '' %>">
    </div>
    <div class="mb-3">
      <label for="category" class="form-label">Category</label>
      <input type="text" class="form-control" id="category" name="category" value="<%= safeguard.category || '' %>">
    </div>
    <div class="mb-3">
      <label for="subcategory" class="form-label">Subcategory</label>
      <input type="text" class="form-control" id="subcategory" name="subcategory" value="<%= safeguard.subcategory || '' %>">
    </div>
    <div class="mb-3">
      <label for="implementation_cost" class="form-label">Implementation Cost (USD)</label>
      <input type="number" step="0.01" class="form-control" id="implementation_cost" name="implementation_cost" value="<%= safeguard.implementation_cost || 0 %>">
    </div>
    <div class="mb-3">
      <label for="maintenance_cost" class="form-label">Maintenance Cost (USD/yr)</label>
      <input type="number" step="0.01" class="form-control" id="maintenance_cost" name="maintenance_cost" value="<%= safeguard.maintenance_cost || 0 %>">
    </div>
    <div class="mb-3">
      <label for="effectiveness_justification" class="form-label">Effectiveness Justification</label>
      <textarea class="form-control" id="effectiveness_justification" name="effectiveness_justification" rows="2"><%= safeguard.effectiveness_justification || '' %></textarea>
    </div>
    <div class="mb-3">
      <label for="last_effectiveness_review" class="form-label">Last Effectiveness Review</label>
      <input type="date" class="form-control" id="last_effectiveness_review" name="last_effectiveness_review" value="<%= safeguard.last_effectiveness_review ? safeguard.last_effectiveness_review.toISOString().slice(0,10) : '' %>">
    </div>
    <div class="mb-3">
      <label for="reusable" class="form-label">Reusable</label>
      <select class="form-select" id="reusable" name="reusable">
        <option value="true" <%= safeguard.reusable ? 'selected' : '' %>>Yes</option>
        <option value="false" <%= !safeguard.reusable ? 'selected' : '' %>>No</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary">Save Changes</button>
    <a href="/safeguards" class="btn btn-secondary ms-2">Cancel</a>
  </form>
</div>

<!-- Load form utilities -->
<script src="/js/utils/forms.js"></script>
<script src="/js/safeguard-edit.js"></script>

<%- include('partials/footer') %>
