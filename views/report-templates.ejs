<%- include('partials/header', { pageTitle: 'Report Templates - Threat Model Generator', active: 'reportTemplates', extraCss: [] }) %>

<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="mb-0">Report Templates</h1>
    <div class="btn-group">
      <button type="button" class="btn btn-primary" id="createReportTemplateBtn">
        <i class="bi bi-plus-circle me-1"></i>Create New Template
      </button>
      <button type="button" class="btn btn-outline-secondary" id="refreshReportTemplates">
        <i class="bi bi-arrow-repeat me-1"></i>Refresh
      </button>
    </div>
  </div>

  <!-- Toast container for notifications -->
  <div id="toastContainer" class="toast-container position-fixed bottom-0 end-0 p-3"></div>

  <!-- Search and Bulk Actions Row -->
  <div class="row mb-3">
    <div class="col-md-6">
      <div class="input-group">
        <input type="text" class="form-control" id="searchReportTemplates" placeholder="Search report templates...">
        <button class="btn btn-outline-primary" type="button" id="searchButton">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </div>
    <div class="col-md-6 text-md-end">
      <div class="btn-group">
        <button type="button" class="btn btn-outline-danger" id="deleteSelectedBtn" disabled>
          <i class="bi bi-trash me-1"></i>Delete Selected
        </button>
        <button type="button" class="btn btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
          <i class="bi bi-gear me-1"></i>Actions
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><button class="dropdown-item" type="button" id="selectAllBtn"><i class="bi bi-check-all me-2"></i>Select All</button></li>
          <li><button class="dropdown-item" type="button" id="deselectAllBtn"><i class="bi bi-x-lg me-2"></i>Deselect All</button></li>
          <li><hr class="dropdown-divider"></li>
          <li><button class="dropdown-item" type="button" id="exportSelectedBtn"><i class="bi bi-download me-2"></i>Export Selected</button></li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Hidden API base used by client JS (keeps current backend) -->
  <input type="hidden" id="apiBase" value="http://localhost:3010">

  <!-- Report Templates Table -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0" id="report-templates-table">
          <thead class="table-light">
            <tr>
              <th width="40">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" id="selectAll">
                </div>
              </th>
              <th>Name</th>
              <th>Description</th>
              <th width="180">Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Filled by JS -->
          </tbody>
        </table>
      </div>
      <div class="alert alert-info m-3 d-none" id="emptyState">
        <i class="bi bi-info-circle me-2"></i>No report templates found. Click "Create New Template" to add one.
      </div>
    </div>
  </div>
</div>

<!-- Deletion Confirmation Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmModalLabel">Confirm Deletion</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="confirmModalBody">
        Are you sure you want to delete the selected templates? This action cannot be undone.
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
      </div>
    </div>
  </div>
  </div>

<!-- Version Edit Modal (preserved functionality) -->
<div class="modal fade" id="versionModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="versionModalLabel">Edit Template Content</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <textarea id="versionContent" class="form-control" rows="15"></textarea>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="btnSaveVersion">Save as New Version</button>
      </div>
    </div>
  </div>
</div>

<script src="/js/report-templates-manager.js"></script>
<%- include('partials/footer') %>
